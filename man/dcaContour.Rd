% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dcaContour.R
\name{dcaContour}
\alias{dcaContour}
\title{Decision-curve analysis contour plot for survival outcomes}
\usage{
dcaContour(data, time, threshold, model, option = NULL, model2 = NULL)
}
\arguments{
\item{data}{A \code{data.frame} containing the survival outcome and all
predictors used in \code{model} (and \code{model2}, if supplied).}

\item{time}{Numeric vector of follow-up times at which to evaluate net
benefit and draw contours (x-axis).}

\item{threshold}{Numeric vector of risk-threshold probabilities at which to
evaluate net benefit (y-axis).}

\item{model}{A fitted Cox proportional hazards model, typically a
\code{\link[survival]{coxph}} object. This is the primary model whose
net benefit surface is plotted.}

\item{option}{Character string specifying what to display in the contour
plot. Allowed values are
\itemize{
  \item \code{"Treat All"}: net benefit of the treat-all strategy.
  \item \code{"Treat None"}: net benefit of the treat-none strategy.
  \item \code{"Compare with All"}: difference in net benefit between the
    model-based strategy and the treat-all strategy.
  \item \code{"Compare two models"}: difference in net benefit between
    \code{model} and \code{model2}.
}
The default (\code{NULL}) is to plot the net benefit of the model-based
strategy itself.}

\item{model2}{Optional second \code{coxph} model to compare against
\code{model} when \code{option = "Compare two models"}.}
}
\value{
A \code{\link[plotly]{plotly}} object showing a contour heatmap of net
benefit (or net benefit difference) over time and threshold.
}
\description{
Produces a contour plot of net benefit from time-dependent decision-curve
analysis (DCA) for a Cox proportional hazards model. The x-axis represents
follow-up time and the y-axis represents the risk-threshold probability
used to define a positive prediction. At each time point the function
computes net benefit for the strategies "treat all", "treat none", and a
model-based strategy using \code{dcurves::dca()}. Optionally, a second
model can be supplied to visualize the difference in net benefit between
the two models.
}
\details{
For each time point in \code{time}, the function first converts the model
predictions to time-dependent risks using
\code{\link[survival]{survfit}} and then calls
\code{\link[dcurves]{dca}} to obtain net benefit for the treat-all,
treat-none, and model-based strategies across the grid of threshold
probabilities. When there are not enough events to estimate survival
probability at a given time and threshold, the function replaces missing
net benefit values using a conservative backup calculation based on
true-positive and false-positive rates and reports this in the console.

The resulting net benefit matrix is visualized with
\code{\link[plotly]{plot_ly}} as a contour plot, optionally showing
differences between strategies, which facilitates identifying clinically
meaningful timeâ€“threshold regions where a model provides incremental value.
}
\examples{
if (requireNamespace("dcurves", quietly = TRUE) &&
    requireNamespace("readr", quietly = TRUE) &&
    requireNamespace("labelled", quietly = TRUE) &&
    requireNamespace("dplyr", quietly = TRUE) &&
    requireNamespace("survival", quietly = TRUE) &&
    requireNamespace("plotly", quietly = TRUE)) {

  library(dplyr)
  library(dcurves)
  library(survival)
  library(plotly)

  df_time_to_cancer_dx <-
    readr::read_csv(
      file = paste0(
        "https://raw.githubusercontent.com/",
        "ddsjoberg/dca-tutorial/main/data/df_time_to_cancer_dx.csv"
      )
    ) \%>\%
    labelled::set_variable_labels(
      patientid        = "Patient ID",
      cancer           = "Cancer Diagnosis",
      ttcancer         = "Years to Diagnosis/Censor",
      risk_group       = "Risk Group",
      age              = "Patient Age",
      famhistory       = "Family History",
      marker           = "Marker",
      cancerpredmarker = "Prediction Model",
      cancer_cr        = "Cancer Diagnosis Status"
    )

  coxmod <- coxph(
    Surv(ttcancer, cancer) ~ age + famhistory + marker,
    data = df_time_to_cancer_dx
  )

  time_seq <- seq(
    min(df_time_to_cancer_dx$ttcancer),
    stats::quantile(df_time_to_cancer_dx$ttcancer, 0.9),
    length.out = 21
  )
  thres_seq <- seq(0, 0.5, 0.01)

  # Net benefit surface of the model versus default strategies
  tempPlot <- dcaContour(
    data      = df_time_to_cancer_dx,
    time      = time_seq,
    threshold = thres_seq,
    model     = coxmod,
    option    = "Compare with All"
  )

  # Difference in net benefit between two Cox models
  coxmod2 <- coxph(
    Surv(ttcancer, cancer) ~ age,
    data = df_time_to_cancer_dx
  )

  tempPlot2 <- dcaContour(
    data      = df_time_to_cancer_dx,
    time      = time_seq,
    threshold = thres_seq,
    model     = coxmod,
    option    = "Compare two models",
    model2    = coxmod2
  )
}

}
\seealso{
\code{\link[dcurves]{dca}} for the underlying decision-curve analysis and
\code{\link[survival]{coxph}} for fitting Cox models.
}
